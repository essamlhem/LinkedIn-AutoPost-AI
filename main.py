import google.generativeai as genai
import datetime
import os
import requests

# 1. ุฅุนุฏุงุฏ ุงูููุงุชูุญ ูู Secrets
GEMINI_KEY = os.getenv("GEMINI_API_KEY")
TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")

genai.configure(api_key=GEMINI_KEY)
model = genai.GenerativeModel('gemini-2.5-flash')

def get_content():
    day_of_week = datetime.datetime.now().weekday()
    
    # ุฃูุงูุฑ ุซุงุจุชุฉ ูุถูุงู ุฌูุฏุฉ ุงููุญุชูู ูุดููู
    prompt = """
    ุฃูุช ุฎุจูุฑ AI ุชูุฏู ูุญุชูู ุชุนูููู ุนูู LinkedIn. ุงูุชุจ ููุดูุฑุงู ูุงููุงู ูุฌุงูุฒุงู ูููุดุฑ.
    
    ูููู ุงูููุดูุฑ ุงููุทููุจ:
    1. ุงูุนููุงู: ๐ ุณูุณูุฉ ุชุจุณูุท ุงูููุงููู | ุญููุฉ ุงูููู: [ุงุณู ุงูููููู ุงูุชููู].
    2. ุงูุดุฑุญ: ุงุดุฑุญ ุงูููููู ุจู 3 ุฃุณุทุฑ ุจุณูุทุฉ ุฌุฏุงู (ูููุฉ ุนูููุฉ).
    3. ุงูููุฏ: ุถุน ููุฏ Python ุชูุถูุญู (ุจุณูุท ุฌุฏุงู ููุตูุฑ) ูุดุฑุญ ุงูููุฑุฉ ุนูููุงู.
    4. ุงูุณุคุงู: ุงุฎุชู ุงูููุดูุฑ ุจุณุคุงู ุฐูู ูุญูุฒ ุงููุชุงุจุนูู ุนูู ุงูุชุนููู.
    
    ููู ุฌุฏุงู:
    - ูุง ุชุณุชุฎุฏู ุงูุฑููุฒ ุงููุนูุฏุฉ ุฃู ุงูุชูุณููุงุช ุงูุชู ูุฏ ุชุณุจุจ ุฎุทุฃ ูู ุงูุชููุฌุฑุงู.
    - ุงุฌุนู ุงูููุฏ ูู ุงูุฌุฒุก ุงููุฑูุฒู ูู ุงูููุดูุฑ.
    - ูุบุฉ ุงูููุดูุฑ: ุงูุนุฑุจูุฉ ุงููุตุญู ุงูุจุณูุทุฉ.
    """
    
    # ุฅุฐุง ูุงู ููู ุงูุณุจุชุ ูุทูุจ ููู ุฃู ุชููู ุงูุญููุฉ ูู ุงูุชุชุงุญูุฉ ูุณูุณูุฉ ุงูุฃุณุจูุน
    if day_of_week == 5:
        prompt += "\nููุงุญุธุฉ: ุงูููู ูู ุงูุณุจุชุ ุงุฌุนู ุงูููุดูุฑ ูุจุฏู ูุจุฏุงูุฉ ูุณูุณูุฉ ุชุนููููุฉ ุฌุฏูุฏุฉ ููุฐุง ุงูุฃุณุจูุน."

    response = model.generate_content(prompt)
    return response.text

def send_to_telegram(text):
    print("ุฌุงุฑู ุฅุฑุณุงู ุงูุจูุณุช ุงููุงูู ุฅูู ุชูุฌุฑุงู...")
    url = f"https://api.telegram.org/bot{TELEGRAM_TOKEN}/sendMessage"
    
    # ุชุฐููุฑ ูููู ูู ุจุฏุงูุฉ ุงูุฑุณุงูุฉ
    reminder_text = "๐ **ุชุฐููุฑ ูุง ุนูุณู: ููุดูุฑ ุงูููู ุฌุงูุฒ ูููุดุฑ!**\n\n" + text
    
    payload = {
        'chat_id': CHAT_ID,
        'text': reminder_text
    }
    
    response = requests.post(url, data=payload)
    
    if response.status_code == 200:
        print("โ ูุตู ุงูุจูุณุช ุจูุฌุงุญ!")
    else:
        # ูุญุงููุฉ ุฃุฎูุฑุฉ ูู ุญุงู ูุฌูุฏ ุฎุทุฃ ูู ุงูุฑููุฒ ุงูุจุฑูุฌูุฉ
        print("โ๏ธ ูุญุงููุฉ ุงูุฅุฑุณุงู ุจุฏูู ุชูุณูู ูุชุฌูุจ ุงูุฃุฎุทุงุก...")
        requests.post(url, data={'chat_id': CHAT_ID, 'text': reminder_text})

if __name__ == "__main__":
    try:
        content = get_content()
        send_to_telegram(content)
    except Exception as e:
        print(f"ุญุฏุซ ุฎุทุฃ: {e}")
